/*! Kefir.js v0.4.0
 *  https://github.com/pozadi/kefir
 */

!function(a){"use strict";function b(){for(var a=0;a<arguments.length;a++)if(!arguments[a])return arguments[a];return arguments[a-1]}function c(){for(var a=0;a<arguments.length;a++)if(arguments[a])return arguments[a];return arguments[a-1]}function d(a){return!a}function e(a,b){var c,d,e,f;if(0===a.length)return b;if(0===b.length)return a;for(f=0,c=new Array(a.length+b.length),d=a.length,e=0;d>e;e++,f++)c[f]=a[e];for(d=b.length,e=0;d>e;e++,f++)c[f]=b[e];return c}function f(a,b){var c,d=a.length;for(c=0;d>c;c++)if(a[c]===b)return c;return-1}function g(a,b){var c,d=a.length;for(c=0;d>c;c++)if(b(a[c]))return c;return-1}function h(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function i(a,b){var c,d,e,f=a.length;if(b>=0&&f>b){if(1===f)return[];for(c=new Array(f-1),d=0,e=0;f>d;d++)d!==b&&(c[e]=a[d],e++);return c}return a}function j(a,b){return i(a,g(a,b))}function k(a,b){var c,d=a.length;for(c=0;d>c;c++)b(a[c])}function l(a,b){var c,d=a.length;for(c=0;d>c;c++)a[c]=b}function m(a,b){return-1!==f(a,b)}function n(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function o(a,b,c){var d,e=Math.min(c,a.length+1),f=a.length-e+1,g=new Array(e);for(d=f;e>d;d++)g[d-f]=a[d];return g[e-1]=b,g}function p(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function q(a,b){switch(b){case 0:return function(){return a()};case 1:return function(b){return a(b[0])};case 2:return function(b){return a(b[0],b[1])};case 3:return function(b){return a(b[0],b[1],b[2])};case 4:return function(b){return a(b[0],b[1],b[2],b[3])};default:return function(b){return a.apply(null,b)}}}function r(a,b,c){var d=c?c.length:0;if(null==b)switch(d){case 0:return a();case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2]);case 4:return a(c[0],c[1],c[2],c[3]);default:return a.apply(null,c)}else switch(d){case 0:return a.call(b);default:return a.apply(b,c)}}function s(a,b,c){return a&&b in a?a[b]:c}function t(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function u(a){var b=function(){};return b.prototype=a,new b}function v(a){var b,c,d=arguments.length;for(b=1;d>b;b++)for(c in arguments[b])a[c]=arguments[b][c];return a}function w(a,b){var c,d=arguments.length;for(a.prototype=u(b.prototype),a.prototype.constructor=a,c=2;d>c;c++)v(a.prototype,arguments[c]);return a}function x(){}function y(a){return a}function z(a,b){return a===b}function A(a,b){return[a,b]}function B(a){return"function"==typeof a}function C(a,b){function c(a,b){I.call(this),this._wait=a,this._intervalId=null;var c=this;this._$onTick=function(){c._onTick()},this._init(b)}w(c,I,{_name:a,_init:function(){},_free:function(){},_onTick:function(){},_onActivation:function(){this._intervalId=setInterval(this._$onTick,this._wait)},_onDeactivation:function(){null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)},_clear:function(){I.prototype._clear.call(this),this._$onTick=null,this._free()}},b),Y[a]=function(a){return new c(a,n(arguments,1,[]))}}function D(a,b,c){function d(c){function d(b,d){c.call(this),this._source=b,this._name=b._name+"."+a,this._init(d);var e=this;this._$handleAny=function(a){e._handleAny(a)}}return w(d,c,{_clear:function(){c.prototype._clear.call(this),this._source=null,this._$handleAny=null,this._free()}},b),d}c=v({streamMethod:function(a){return function(){return new a(this,arguments)}},propertyMethod:function(a,b){return function(){return new b(this,arguments)}}},c||{}),b=v({_init:function(){},_free:function(){},_handleValue:function(a,b){this._send(ab,a,b)},_handleError:function(a,b){this._send(bb,a,b)},_handleEnd:function(a,b){this._send(_,null,b)},_handleAny:function(a){switch(a.type){case ab:this._handleValue(a.value,a.current);break;case bb:this._handleError(a.value,a.current);break;case _:this._handleEnd(a.value,a.current)}},_onActivation:function(){this._source.onAny(this._$handleAny)},_onDeactivation:function(){this._source.offAny(this._$handleAny)}},b||{});var e=d(I),f=d(J);c.streamMethod&&(I.prototype[a]=c.streamMethod(e,f)),c.propertyMethod&&(J.prototype[a]=c.propertyMethod(e,f))}function E(a,b){function c(c){function d(b,d){c.call(this),this._primary=b,this._secondary=d,this._name=b._name+"."+a,this._lastSecondary=Z,this._lastError=Z;var e=this;this._$handleSecondaryAny=function(a){e._handleSecondaryAny(a)},this._$handlePrimaryAny=function(a){e._handlePrimaryAny(a)},this._init()}return w(d,c,{_clear:function(){c.prototype._clear.call(this),this._primary=null,this._secondary=null,this._lastSecondary=null,this._lastError=null,this._$handleSecondaryAny=null,this._$handlePrimaryAny=null,this._free()}},b),d}b=v({_init:function(){},_free:function(){},_handlePrimaryValue:function(a,b){this._send(ab,a,b)},_handlePrimaryError:function(a,b){this._send(bb,a,b)},_handlePrimaryEnd:function(a,b){this._send(_,null,b)},_handleSecondaryValue:function(a){this._lastSecondary=a},_handleSecondaryError:function(a){this._lastError=a},_handleSecondaryEnd:function(){},_handlePrimaryAny:function(a){switch(a.type){case ab:this._handlePrimaryValue(a.value,a.current);break;case bb:this._handlePrimaryError(a.value,a.current);break;case _:this._handlePrimaryEnd(a.value,a.current)}},_handleSecondaryAny:function(a){switch(a.type){case ab:this._handleSecondaryValue(a.value);break;case bb:this._handleSecondaryError(a.value);break;case _:this._handleSecondaryEnd(a.value,a.current),this._removeSecondary()}},_removeSecondary:function(){null!==this._secondary&&(this._secondary.offAny(this._$handleSecondaryAny),this._$handleSecondaryAny=null,this._secondary=null)},_onActivation:function(){null!==this._secondary&&this._secondary.onAny(this._$handleSecondaryAny),this._alive&&this._primary.onAny(this._$handlePrimaryAny)},_onDeactivation:function(){null!==this._secondary&&this._secondary.offAny(this._$handleSecondaryAny),this._primary.offAny(this._$handlePrimaryAny)}},b||{});var d=c(I),e=c(J);I.prototype[a]=function(a){return new d(this,a)},J.prototype[a]=function(a){return new e(this,a)}}function F(){this._items=[]}function G(a,b,c){return{type:a,value:b,current:!!c}}function H(){this._subscribers=new F,this._active=!1,this._alive=!0}function I(){H.call(this)}function J(){H.call(this),this._current=Z}function K(a){if(I.call(this),this._queueLim=s(a,"queueLim",0),this._concurLim=s(a,"concurLim",-1),this._drop=s(a,"drop","new"),0===this._concurLim)throw new Error("options.concurLim can't be 0");var b=this;this._$handleSubAny=function(a){b._handleSubAny(a)},this._queue=[],this._curSources=[],this._activating=!1}function L(a){K.call(this),0===a.length?this._send(_):this._addAll(a),this._initialised=!0}function M(a){K.call(this,{concurLim:1,queueLim:-1}),0===a.length?this._send(_):this._addAll(a),this._initialised=!0}function N(){K.call(this)}function O(){K.call(this)}function P(a,b,c){K.call(this,c),this._source=a,this._fn=b||y,this._mainEnded=!1,this._lastCurrent=null;var d=this;this._$handleMainSource=function(a){d._handleMainSource(a)}}function Q(a,b,c){I.call(this),0===b.length?this._send(_):(this._passiveCount=a.length,this._sources=e(a,b),this._combinator=c?q(c,this._sources.length):y,this._aliveCount=0,this._currents=new Array(this._sources.length),l(this._currents,Z),this._activating=!1,this._emitAfterActivation=!1,this._endAfterActivation=!1)}function R(a,b){return function(c){a._handleAny(b,c)}}function S(a){return function(){return new a(this,arguments)}}function T(a,b){return function(){return new b(this,arguments)}}function U(a){return{step:function(b,c){return a._send(ab,c,a._forcedCurrent),null},result:function(){return a._send(_,null,a._forcedCurrent),null}}}function V(a){I.call(this),this._fn=a,this._unsubscribe=null}function W(){I.call(this)}function X(a){J.call(this),this._send(ab,a),this._send(_)}var Y={},Z=["<nothing>"],_="end",ab="value",bb="error",cb="any",db=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},eb=(Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},function(a){return"[object Arguments]"===Object.prototype.toString.call(a)});eb(arguments)||(eb=function(a){return!(!a||!t(a,"callee"))}),v(F,{callOne:function(a,b){a.type===cb?a.fn(b):a.type===b.type&&(a.type===ab||a.type===bb?a.fn(b.value):a.fn())},callOnce:function(a,b,c){a===cb?b(c):a===c.type&&(a===ab||a===bb?b(c.value):b())}}),v(F.prototype,{add:function(a,b,c){this._items=e(this._items,[{type:a,fn:b,key:c||{}}])},remove:function(a,b,c){this._items=j(this._items,function(d){return d.type===a&&(d.fn===b||p(d.key,c))})},callAll:function(a){for(var b=this._items,c=0;c<b.length;c++)F.callOne(b[c],a)},isEmpty:function(){return 0===this._items.length}});var fb=G(_,void 0,!0);Y.Observable=H,v(H.prototype,{_name:"observable",_onActivation:function(){},_onDeactivation:function(){},_setActive:function(a){this._active!==a&&(this._active=a,a?this._onActivation():this._onDeactivation())},_clear:function(){this._setActive(!1),this._alive=!1,this._subscribers=null},_send:function(a,b,c){this._alive&&(this._subscribers.callAll(G(a,b,c)),a===_&&this._clear())},on:function(a,b,c){return this._alive?(this._subscribers.add(a,b,c),this._setActive(!0)):F.callOnce(a,b,fb),this},off:function(a,b,c){return this._alive&&(this._subscribers.remove(a,b,c),this._subscribers.isEmpty()&&this._setActive(!1)),this},onValue:function(a,b){return this.on(ab,a,b)},onError:function(a,b){return this.on(bb,a,b)},onEnd:function(a,b){return this.on(_,a,b)},onAny:function(a,b){return this.on(cb,a,b)},offValue:function(a,b){return this.off(ab,a,b)},offError:function(a,b){return this.off(bb,a,b)},offEnd:function(a,b){return this.off(_,a,b)},offAny:function(a,b){return this.off(cb,a,b)}}),H.prototype.toString=function(){return"["+this._name+"]"},Y.Stream=I,w(I,H,{_name:"stream"}),Y.Property=J,w(J,H,{_name:"property",_send:function(a,b,c){this._alive&&(c||this._subscribers.callAll(G(a,b)),a===ab&&(this._current=b),(a===_||a===bb)&&this._clear())},on:function(a,b,c){return this._alive&&(this._subscribers.add(a,b,c),this._setActive(!0)),this._current!==Z&&F.callOnce(a,b,G(ab,this._current,!0)),this._alive||F.callOnce(a,b,fb),this}}),H.prototype.log=function(a){return a=a||this.toString(),this.onAny(function(b){var c="<"+b.type+(b.current?":current":"")+">";b.type===ab?console.log(a,c,b.value):console.log(a,c)},"__logKey__"+a),this},H.prototype.offLog=function(a){return a=a||this.toString(),this.offAny(null,"__logKey__"+a),this},C("withInterval",{_init:function(a){this._fn=a[0];var b=this;this._emitter={emit:function(a){b._send(ab,a)},error:function(a){b._send(bb,a)},end:function(){b._send(_)}}},_free:function(){this._fn=null,this._emitter=null},_onTick:function(){try{this._fn(this._emitter)}catch(a){this._send(bb,a)}}}),C("fromPoll",{_init:function(a){this._fn=a[0]},_free:function(){this._fn=null},_onTick:function(){var a=null;try{a=this._fn()}catch(b){this._send(bb,b)}this._send(ab,a)}}),C("interval",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send(ab,this._x)}}),C("sequentially",{_init:function(a){this._xs=h(a[0]),0===this._xs.length&&this._send(_)},_free:function(){this._xs=null},_onTick:function(){switch(this._xs.length){case 1:this._send(ab,this._xs[0]),this._send(_);break;default:this._send(ab,this._xs.shift())}}}),C("repeatedly",{_init:function(a){this._xs=h(a[0]),this._i=-1},_onTick:function(){this._xs.length>0&&(this._i=(this._i+1)%this._xs.length,this._send(ab,this._xs[this._i]))}}),C("later",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send(ab,this._x),this._send(_)}}),w(K,I,{_name:"abstractPool",_add:function(a,b){b=b||y,-1===this._concurLim||this._curSources.length<this._concurLim?this._addToCur(b(a)):-1===this._queueLim||this._queue.length<this._queueLim?this._addToQueue(b(a)):"old"===this._drop&&(this._removeOldest(),this._add(b(a)))},_addAll:function(a){var b=this;k(a,function(a){b._add(a)})},_remove:function(a){-1===this._removeCur(a)&&this._removeQueue(a)},_addToQueue:function(a){this._queue=e(this._queue,[a])},_addToCur:function(a){this._curSources=e(this._curSources,[a]),this._active&&this._sub(a)},_sub:function(a){var b=this;a.onAny(this._$handleSubAny),a.onEnd(function(){b._removeCur(a)},[this,a])},_unsub:function(a){a.offAny(this._$handleSubAny),a.offEnd(null,[this,a])},_handleSubAny:function(a){a.type===ab?this._send(ab,a.value,a.current&&this._activating):a.type===bb&&this._send(bb,a.value,a.current&&this._activating)},_removeQueue:function(a){var b=f(this._queue,a);return this._queue=i(this._queue,b),b},_removeCur:function(a){this._active&&this._unsub(a);var b=f(this._curSources,a);return this._curSources=i(this._curSources,b),-1!==b&&(0!==this._queue.length?this._pullQueue():0===this._curSources.length&&this._onEmpty()),b},_removeOldest:function(){this._removeCur(this._curSources[0])},_pullQueue:function(){0!==this._queue.length&&(this._queue=h(this._queue),this._addToCur(this._queue.shift()))},_onActivation:function(){var a,b=this._curSources;for(this._activating=!0,a=0;a<b.length;a++)this._sub(b[a]);this._activating=!1},_onDeactivation:function(){var a,b=this._curSources;for(a=0;a<b.length;a++)this._unsub(b[a])},_isEmpty:function(){return 0===this._curSources.length},_onEmpty:function(){},_clear:function(){I.prototype._clear.call(this),this._queue=null,this._curSources=null,this._$handleSubAny=null}});var gb={_onEmpty:function(){this._initialised&&this._send(_,null,this._activating)}};w(L,K,v({_name:"merge"},gb)),Y.merge=function(a){return new L(a)},H.prototype.merge=function(a){return Y.merge([this,a])},w(M,K,v({_name:"concat"},gb)),Y.concat=function(a){return new M(a)},H.prototype.concat=function(a){return Y.concat([this,a])},w(N,K,{_name:"pool",plug:function(a){return this._add(a),this},unplug:function(a){return this._remove(a),this}}),Y.pool=function(){return new N},w(O,K,{_name:"bus",plug:function(a){return this._add(a),this},unplug:function(a){return this._remove(a),this},emit:function(a){return this._send(ab,a),this},error:function(a){return this._send(bb,a),this},end:function(){return this._send(_),this}}),Y.bus=function(){return new O},w(P,K,{_onActivation:function(){K.prototype._onActivation.call(this),this._activating=!0,this._source.onAny(this._$handleMainSource),this._activating=!1},_onDeactivation:function(){K.prototype._onDeactivation.call(this),this._source.offAny(this._$handleMainSource)},_handleMainSource:function(a){a.type===ab?(a.current&&this._lastCurrent===a.value||this._add(a.value,this._fn),this._lastCurrent=a.value):this._isEmpty()?this._send(_,null,a.current):this._mainEnded=!0},_onEmpty:function(){this._mainEnded&&this._send(_)},_clear:function(){K.prototype._clear.call(this),this._source=null,this._lastCurrent=null,this._$handleMainSource=null}}),H.prototype.flatMap=function(a){return new P(this,a).setName(this,"flatMap")},H.prototype.flatMapLatest=function(a){return new P(this,a,{concurLim:1,drop:"old"}).setName(this,"flatMapLatest")},H.prototype.flatMapFirst=function(a){return new P(this,a,{concurLim:1}).setName(this,"flatMapFirst")},H.prototype.flatMapConcat=function(a){return new P(this,a,{queueLim:-1,concurLim:1}).setName(this,"flatMapConcat")},H.prototype.flatMapConcurLimit=function(a,b){var c;return 0===b?c=Y.never():(0>b&&(b=-1),c=new P(this,a,{queueLim:-1,concurLim:b})),c.setName(this,"flatMapConcurLimit")},w(Q,I,{_name:"sampledBy",_onActivation:function(){var a,b=this._sources.length;for(this._aliveCount=b-this._passiveCount,this._activating=!0,a=0;b>a;a++)this._sources[a].onAny(R(this,a),[this,a]);this._activating=!1,this._emitAfterActivation&&(this._emitAfterActivation=!1,this._emitIfFull(!0)),this._endAfterActivation&&this._send(_,null,!0)},_onDeactivation:function(){var a,b=this._sources.length;for(a=0;b>a;a++)this._sources[a].offAny(null,[this,a])},_emitIfFull:function(a){if(!m(this._currents,Z)){var b=h(this._currents);b=this._combinator(b),this._send(ab,b,a)}},_handleAny:function(a,b){b.type===ab?(this._currents[a]=b.value,a>=this._passiveCount&&(this._activating?this._emitAfterActivation=!0:this._emitIfFull(b.current))):a>=this._passiveCount&&(this._aliveCount--,0===this._aliveCount&&(this._activating?this._endAfterActivation=!0:this._send(_,null,b.current)))},_clear:function(){I.prototype._clear.call(this),this._sources=null,this._currents=null,this._combinator=null}}),Y.sampledBy=function(a,b,c){return new Q(a,b,c)},H.prototype.sampledBy=function(a,b){return Y.sampledBy([this],[a],b||y)},Y.combine=function(a,b){var c=new Q([],a,b);return c._name="combine",c},H.prototype.combine=function(a,b){return Y.combine([this,a],b)},D("toProperty",{_init:function(a){a.length>0&&this._send(ab,a[0])}},{propertyMethod:null,streamMethod:T}),D("withDefault",{_init:function(a){this._send(ab,a[0],!0)}},{propertyMethod:T,streamMethod:T}),D("changes",{_handleValue:function(a,b){b||this._send(ab,a)}},{streamMethod:null,propertyMethod:S}),D("withHandler",{_init:function(a){this._handler=a[0],this._forcedCurrent=!1;var b=this;this._emitter={emit:function(a){b._send(ab,a,b._forcedCurrent)},error:function(a){b._send(bb,a,b._forcedCurrent)},end:function(){b._send(_,null,b._forcedCurrent)}}},_free:function(){this._handler=null,this._emitter=null},_handleAny:function(a){this._forcedCurrent=a.current;try{this._handler(this._emitter,a)}catch(b){this._send(bb,b,this._forcedCurrent)}this._forcedCurrent=!1}}),D("flatten",{_init:function(a){this._fn=a[0]?a[0]:y},_free:function(){this._fn=null},_handleValue:function(a,b){var c=[];try{c=this._fn(a)}catch(d){this._send(bb,d,b)}for(var e=0;e<c.length;e++)this._send(ab,c[e],b)}}),D("transduce",{_init:function(a){this._xform=a[0](U(this))},_free:function(){this._xform=null},_handleValue:function(a,b){this._forcedCurrent=b;try{null!==this._xform.step(null,a)&&this._xform.result(null)}catch(c){this._send(bb,c,b)}this._forcedCurrent=!1},_handleEnd:function(a,b){this._forcedCurrent=b,this._xform.result(null),this._forcedCurrent=!1}});var hb={_init:function(a){this._fn=a[0]||y},_free:function(){this._fn=null}};D("map",v({_handleValue:function(a,b){try{this._send(ab,this._fn(a),b)}catch(c){this._send(bb,c,b)}}},hb)),D("filter",v({_handleValue:function(a,b){try{this._fn(a)&&this._send(ab,a,b)}catch(c){this._send(bb,c,b)}}},hb)),D("takeWhile",v({_handleValue:function(a,b){var c=!1;try{c=this._fn(a)}catch(d){this._send(bb,d,b)}c?this._send(ab,a,b):this._send(_,null,b)}},hb)),D("take",{_init:function(a){this._n=a[0],this._n<=0&&this._send(_)},_handleValue:function(a,b){this._n--,this._send(ab,a,b),0===this._n&&this._send(_,null,b)}}),D("skip",{_init:function(a){this._n=Math.max(0,a[0])},_handleValue:function(a,b){0===this._n?this._send(ab,a,b):this._n--}}),D("skipDuplicates",{_init:function(a){this._fn=a[0]||z,this._prev=Z},_free:function(){this._fn=null,this._prev=null},_handleValue:function(a,b){var c=!1;try{c=this._fn(this._prev,a)}catch(d){this._send(bb,d,b)}this._prev!==Z&&c||(this._send(ab,a,b),this._prev=a)}}),D("skipWhile",{_init:function(a){this._fn=a[0]||y,this._skip=!0},_free:function(){this._fn=null},_handleValue:function(a,b){if(!this._skip)return void this._send(ab,a,b);var c=!0;try{c=this._fn(a)}catch(d){this._send(bb,d,b)}c||(this._skip=!1,this._fn=null,this._send(ab,a,b))}}),D("diff",{_init:function(a){this._fn=a[0]||A,this._prev=a.length>1?a[1]:Z},_free:function(){this._prev=null,this._fn=null},_handleValue:function(a,b){if(this._prev!==Z)try{this._send(ab,this._fn(this._prev,a),b)}catch(c){this._send(bb,c,b)}this._prev=a}}),D("scan",{_init:function(a){this._fn=a[0],a.length>1&&this._send(ab,a[1],!0)},_free:function(){this._fn=null},_handleValue:function(a,b){try{this._current!==Z&&(a=this._fn(this._current,a)),this._send(ab,a,b)}catch(c){this._send(bb,c,b)}}},{streamMethod:T}),D("reduce",{_init:function(a){this._fn=a[0],this._result=a.length>1?a[1]:Z},_free:function(){this._fn=null,this._result=null},_handleValue:function(a){if(this._result===Z)this._result=a;else try{this._result=this._fn(this._result,a)}catch(b){this._send(bb,b)}},_handleEnd:function(a,b){this._result!==Z&&this._send(ab,this._result,b),this._send(_,null,b)}}),D("mapEnd",{_init:function(a){this._fn=a[0]},_free:function(){this._fn=null},_handleEnd:function(a,b){try{this._send(ab,this._fn(),b)}catch(c){this._send(bb,c,b)}this._send(_,null,b)}}),D("skipEnd",{_handleEnd:function(){}}),D("slidingWindow",{_init:function(a){this._max=a[0],this._min=a[1]||0,this._buff=[]},_free:function(){this._buff=null},_handleValue:function(a,b){this._buff=o(this._buff,a,this._max),this._buff.length>=this._min&&this._send(ab,this._buff,b)}}),D("bufferWhile",{_init:function(a){this._fn=a[0]||y,this._buff=[]},_free:function(){this._buff=null},_flush:function(a){this._send(ab,this._buff,a),this._buff=[]},_handleValue:function(a,b){this._buff.push(a);var c=!0;try{c=this._fn(a)}catch(d){this._send(bb,d,b)}c||this._flush(b)},_handleEnd:function(a,b){0!==this._buff.length&&this._flush(b),this._send(_,null,b)}}),D("debounce",{_init:function(a){this._wait=Math.max(0,a[0]),this._immediate=s(a[1],"immediate",!1),this._lastAttempt=0,this._timeoutId=null,this._laterValue=null,this._endLater=!1;var b=this;this._$later=function(){b._later()}},_free:function(){this._laterValue=null,this._$later=null},_handleValue:function(a,b){b?this._send(ab,a,b):(this._lastAttempt=db(),this._immediate&&!this._timeoutId&&this._send(ab,a),this._timeoutId||(this._timeoutId=setTimeout(this._$later,this._wait)),this._immediate||(this._laterValue=a))},_handleEnd:function(a,b){b?this._send(_,null,b):this._timeoutId&&!this._immediate?this._endLater=!0:this._send(_)},_later:function(){var a=db()-this._lastAttempt;a<this._wait&&a>=0?this._timeoutId=setTimeout(this._$later,this._wait-a):(this._timeoutId=null,this._immediate||(this._send(ab,this._laterValue),this._laterValue=null),this._endLater&&this._send(_))}}),D("throttle",{_init:function(a){this._wait=Math.max(0,a[0]),this._leading=s(a[1],"leading",!0),this._trailing=s(a[1],"trailing",!0),this._trailingValue=null,this._timeoutId=null,this._endLater=!1,this._lastCallTime=0;var b=this;this._$trailingCall=function(){b._trailingCall()}},_free:function(){this._trailingValue=null,this._$trailingCall=null},_handleValue:function(a,b){if(b)this._send(ab,a,b);else{var c=db();0!==this._lastCallTime||this._leading||(this._lastCallTime=c);var d=this._wait-(c-this._lastCallTime);0>=d?(this._cancelTraling(),this._lastCallTime=c,this._send(ab,a)):this._trailing&&(this._cancelTraling(),this._trailingValue=a,this._timeoutId=setTimeout(this._$trailingCall,d))}},_handleEnd:function(a,b){b?this._send(_,null,b):this._timeoutId?this._endLater=!0:this._send(_)},_cancelTraling:function(){null!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},_trailingCall:function(){this._send(ab,this._trailingValue),this._timeoutId=null,this._trailingValue=null,this._lastCallTime=this._leading?db():0,this._endLater&&this._send(_)}}),D("delay",{_init:function(a){this._wait=Math.max(0,a[0]),this._buff=[];var b=this;this._$shiftBuff=function(){b._send(ab,b._buff.shift())}},_free:function(){this._buff=null,this._$shiftBuff=null},_handleValue:function(a,b){b?this._send(ab,a,b):(this._buff.push(a),setTimeout(this._$shiftBuff,this._wait))},_handleEnd:function(a,b){if(b)this._send(_,null,b);else{var c=this;setTimeout(function(){c._send(_)},this._wait)}}}),w(V,I,{_name:"fromBinder",_onActivation:function(){var a=this,b=!0,c={emit:function(c){a._send(ab,c,b)},error:function(c){a._send(bb,c,b)},end:function(){a._send(_,null,b)}};this._unsubscribe=null;try{this._unsubscribe=this._fn(c)}catch(d){a._send(bb,d,b),a._send(_,null,b)}b=!1},_onDeactivation:function(){null!==this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null)},_clear:function(){I.prototype._clear.call(this),this._fn=null}}),Y.fromBinder=function(a){return new V(a)},w(W,I,{_name:"emitter",emit:function(a){return this._send(ab,a),this},error:function(a){$._send(bb,a)},end:function(){return this._send(_),this}}),Y.emitter=function(){return new W};var ib=new I;ib._send(_),ib._name="never",Y.never=function(){return ib},w(X,J,{_name:"constant"}),Y.constant=function(a){return new X(a)},H.prototype.setName=function(a,b){return this._name=b?a._name+"."+b:a,this},H.prototype.mapTo=function(a){return this.map(function(){return a}).setName(this,"mapTo")},H.prototype.pluck=function(a){return this.map(function(b){return b[a]}).setName(this,"pluck")},H.prototype.invoke=function(a){var b=n(arguments,1);return this.map(b?function(c){return r(c[a],c,b)}:function(b){return b[a]()}).setName(this,"invoke")},H.prototype.timestamp=function(){return this.map(function(a){return{value:a,time:db()}}).setName(this,"timestamp")},H.prototype.tap=function(a){return this.map(function(b){return a(b),b}).setName(this,"tap")},Y.and=function(a){return Y.combine(a,b).setName("and")},H.prototype.and=function(a){return this.combine(a,b).setName("and")},Y.or=function(a){return Y.combine(a,c).setName("or")},H.prototype.or=function(a){return this.combine(a,c).setName("or")},H.prototype.not=function(){return this.map(d).setName(this,"not")},H.prototype.awaiting=function(a){return Y.merge([this.mapTo(!0),a.mapTo(!1)]).skipDuplicates().toProperty(!1).setName(this,"awaiting")},Y.fromCallback=function(a){var b=!1;return Y.fromBinder(function(c){return b||(a(function(a){c.emit(a),c.end()}),b=!0),x}).setName("fromCallback")},Y._fromEvent=function(a,b,c){return Y.fromBinder(function(d){var e=c?function(){d.emit(r(c,this,arguments))}:d.emit;return a(e),function(){b(e)}})};var jb=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"]];Y.fromEvent=function(a,b,c){for(var d,e,f,g=0;g<jb.length;g++)if(d=jb[g],B(a[d[0]])&&B(a[d[1]])){e=d[0],f=d[1];break}if(void 0===e)throw new Error("target don't support any of addEventListener/removeEventListener, addListener/removeListener, on/off method pair");return Y._fromEvent(function(c){a[e](b,c)},function(c){a[f](b,c)},c).setName("fromEvent")},Y.fromPromise=function(a){return Y.fromBinder(function(b){a.then(function(a){b.emit(a),b.end()},function(a){b.error(a),b.end()})}).setName("fromPromise")},H.prototype.toPromise=function(a){if(a=a||Promise,!a)throw new TypeError("Promise type not provided nor native Promise support");var b=this;return new a(function(a,c){var d,e=!1;b.onValue(function(a){d=a,e=!0}),b.onEnd(function(){e&&a(d)}),b.onError(c)})},E("bufferBy",{_init:function(){this._buff=[]},_free:function(){this._buff=null},_flush:function(a){null!==this._buff&&0!==this._buff.length&&(this._send(ab,this._buff,a),this._buff=[])},_onActivation:function(){this._primary.onAny(this._$handlePrimaryAny),this._alive&&null!==this._secondary&&this._secondary.onAny(this._$handleSecondaryAny)},_handlePrimaryValue:function(a){this._buff.push(a)},_handlePrimaryEnd:function(a,b){this._flush(b),this._send(_,null,b)},_handleSecondaryValue:function(a,b){this._flush(b)}}),E("filterBy",{_handlePrimaryValue:function(a,b){this._lastSecondary!==Z&&this._lastSecondary&&this._send(ab,a,b)},_handleSecondaryEnd:function(a,b){this._lastSecondary!==Z&&this._lastSecondary||this._send(_,null,b)}}),E("skipUntilBy",{_handlePrimaryValue:function(a,b){this._lastSecondary!==Z&&this._send(ab,a,b)},_handleSecondaryValue:function(a){this._lastSecondary=a,this._removeSecondary()},_handleSecondaryEnd:function(a,b){this._lastSecondary===Z&&this._send(_,null,b)}}),E("takeUntilBy",{_handleSecondaryValue:function(a,b){this._send(_,null,b)}}),E("takeWhileBy",{_handlePrimaryValue:function(a,b){this._lastSecondary!==Z&&this._send(ab,a,b)},_handleSecondaryValue:function(a,b){this._lastSecondary=a,this._lastSecondary||this._send(_,null,b)},_handleSecondaryEnd:function(a,b){this._lastSecondary===Z&&this._send(_,null,b)}}),E("skipWhileBy",{_handlePrimaryValue:function(a,b){this._lastSecondary===Z||this._lastSecondary||this._send(ab,a,b)},_handleSecondaryValue:function(a){this._lastSecondary=a,this._lastSecondary||this._removeSecondary()},_handleSecondaryEnd:function(a,b){(this._lastSecondary===Z||this._lastSecondary)&&this._send(_,null,b)}}),"function"==typeof define&&define.amd?(define([],function(){return Y}),a.Kefir=Y):"object"==typeof module&&"object"==typeof exports?(module.exports=Y,Y.Kefir=Y):a.Kefir=Y}(this);
//# sourceMappingURL=kefir.min.js.map